<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to Extreme Value Analysis - Flood Frequency Analysis (FFA) with Block-Maxima</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../evaillustr.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<link href="https://fonts.googleapis.com/css?family=Fira+Sans|Merriweather" rel="stylesheet">
<script src="https://kit.fontawesome.com/0fba9333d8.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Introduction to Extreme Value Analysis">
<meta property="og:description" content="A comprehensive guide to extreme value analysis">
<meta property="og:image" content="https://github.com/diopBachir/tp_eva/blob/master/docs/evaillustr.png">
<meta property="og:site_name" content="Introduction to Extreme Value Analysis">
<meta property="og:locale" content="fr_FR">
<meta name="twitter:title" content="Introduction to Extreme Value Analysis - Flood Frequency Analysis (FFA) with Block-Maxima">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://github.com/diopBachir/tp_eva/blob/master/docs/evaillustr.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Introduction to Extreme Value Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../introduction/index.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../softwaresetup/index.html"> 
<span class="menu-text">Software &amp; Setup</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../blockmaxima/index.html" aria-current="page"> 
<span class="menu-text">Block Maxima Approach</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pot/index.html"> 
<span class="menu-text">Threshold Exceedance (POT)</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="4">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#libraries" id="toc-libraries" class="nav-link active" data-scroll-target="#libraries"><span class="header-section-number">1</span> Libraries</a></li>
  <li><a href="#sec-bmdata" id="toc-sec-bmdata" class="nav-link" data-scroll-target="#sec-bmdata"><span class="header-section-number">2</span> Data import</a></li>
  <li><a href="#extreme-events-sampling" id="toc-extreme-events-sampling" class="nav-link" data-scroll-target="#extreme-events-sampling"><span class="header-section-number">3</span> Extreme events sampling</a>
  <ul>
  <li><a href="#the-block-maxima-approach" id="toc-the-block-maxima-approach" class="nav-link" data-scroll-target="#the-block-maxima-approach"><span class="header-section-number">3.1</span> The block maxima approach</a></li>
  <li><a href="#exract-annual-maximum-floods-amf-from-the-daily-streamflow-serie" id="toc-exract-annual-maximum-floods-amf-from-the-daily-streamflow-serie" class="nav-link" data-scroll-target="#exract-annual-maximum-floods-amf-from-the-daily-streamflow-serie"><span class="header-section-number">3.2</span> Exract annual maximum floods (AMF) from the daily streamflow serie</a></li>
  <li><a href="#display-sampled-events" id="toc-display-sampled-events" class="nav-link" data-scroll-target="#display-sampled-events"><span class="header-section-number">3.3</span> Display sampled events</a></li>
  </ul></li>
  <li><a href="#autocorrelation-testing" id="toc-autocorrelation-testing" class="nav-link" data-scroll-target="#autocorrelation-testing"><span class="header-section-number">4</span> Autocorrelation testing</a>
  <ul>
  <li><a href="#sec-autocorrelation" id="toc-sec-autocorrelation" class="nav-link" data-scroll-target="#sec-autocorrelation"><span class="header-section-number">4.1</span> What is autocorrelation?</a>
  <ul>
  <li><a href="#correlogram" id="toc-correlogram" class="nav-link" data-scroll-target="#correlogram"><span class="header-section-number">4.1.1</span> Correlogram</a></li>
  <li><a href="#sec-wwtest" id="toc-sec-wwtest" class="nav-link" data-scroll-target="#sec-wwtest"><span class="header-section-number">4.1.2</span> Wald-Wolfowitz (WW) test</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-trend" id="toc-sec-trend" class="nav-link" data-scroll-target="#sec-trend"><span class="header-section-number">5</span> Trend detection</a>
  <ul>
  <li><a href="#non-parametric-methods" id="toc-non-parametric-methods" class="nav-link" data-scroll-target="#non-parametric-methods"><span class="header-section-number">5.1</span> Non-parametric methods</a>
  <ul>
  <li><a href="#sec-mk" id="toc-sec-mk" class="nav-link" data-scroll-target="#sec-mk"><span class="header-section-number">5.1.1</span> The Mann-Kendall (MK) test</a></li>
  <li><a href="#sec-sens" id="toc-sec-sens" class="nav-link" data-scroll-target="#sec-sens"><span class="header-section-number">5.1.2</span> Sen‚Äôs slope estimator</a></li>
  </ul></li>
  <li><a href="#parametric-methods" id="toc-parametric-methods" class="nav-link" data-scroll-target="#parametric-methods"><span class="header-section-number">5.2</span> Parametric methods</a></li>
  </ul></li>
  <li><a href="#flood-frequency-analysis-ffa" id="toc-flood-frequency-analysis-ffa" class="nav-link" data-scroll-target="#flood-frequency-analysis-ffa"><span class="header-section-number">6</span> Flood frequency analysis (FFA)</a>
  <ul>
  <li><a href="#probability-distributions" id="toc-probability-distributions" class="nav-link" data-scroll-target="#probability-distributions"><span class="header-section-number">6.1</span> Probability distributions</a></li>
  <li><a href="#models-fitting" id="toc-models-fitting" class="nav-link" data-scroll-target="#models-fitting"><span class="header-section-number">6.2</span> Models fitting</a></li>
  <li><a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection"><span class="header-section-number">6.3</span> Model selection</a></li>
  <li><a href="#perform-ffa" id="toc-perform-ffa" class="nav-link" data-scroll-target="#perform-ffa"><span class="header-section-number">6.4</span> Perform FFA</a>
  <ul>
  <li><a href="#sec-utils" id="toc-sec-utils" class="nav-link" data-scroll-target="#sec-utils"><span class="header-section-number">6.4.1</span> Setup utils</a></li>
  <li><a href="#distributions-fitting" id="toc-distributions-fitting" class="nav-link" data-scroll-target="#distributions-fitting"><span class="header-section-number">6.4.2</span> Distributions fitting</a>
  <ul>
  <li><a href="#stationary-context" id="toc-stationary-context" class="nav-link" data-scroll-target="#stationary-context"><span class="header-section-number">6.4.2.1</span> Stationary context</a></li>
  <li><a href="#parametric-trend-detection" id="toc-parametric-trend-detection" class="nav-link" data-scroll-target="#parametric-trend-detection"><span class="header-section-number">6.4.2.2</span> Parametric trend-detection</a>
  <ul class="collapse">
  <li><a href="#creating-covariate" id="toc-creating-covariate" class="nav-link" data-scroll-target="#creating-covariate"><span class="header-section-number">6.4.2.2.1</span> Creating covariate</a></li>
  <li><a href="#non-stationary-gev-fitting" id="toc-non-stationary-gev-fitting" class="nav-link" data-scroll-target="#non-stationary-gev-fitting"><span class="header-section-number">6.4.2.2.2</span> Non-Stationary GEV fitting</a></li>
  <li><a href="#sec-deviancetest" id="toc-sec-deviancetest" class="nav-link" data-scroll-target="#sec-deviancetest"><span class="header-section-number">6.4.2.2.3</span> Deviance test</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
  <li><a href="#trend-analysis-conclusions" id="toc-trend-analysis-conclusions" class="nav-link" data-scroll-target="#trend-analysis-conclusions"><span class="header-section-number">7</span> Trend analysis conclusions</a></li>
  <li><a href="#flood-quantiles-estimation" id="toc-flood-quantiles-estimation" class="nav-link" data-scroll-target="#flood-quantiles-estimation"><span class="header-section-number">8</span> Flood quantiles estimation</a>
  <ul>
  <li><a href="#stationary-context-1" id="toc-stationary-context-1" class="nav-link" data-scroll-target="#stationary-context-1"><span class="header-section-number">8.1</span> Stationary context</a></li>
  <li><a href="#non-stationary-context" id="toc-non-stationary-context" class="nav-link" data-scroll-target="#non-stationary-context"><span class="header-section-number">8.2</span> Non-Stationary context</a></li>
  </ul></li>
  <li><a href="#uncertainty-estimation" id="toc-uncertainty-estimation" class="nav-link" data-scroll-target="#uncertainty-estimation"><span class="header-section-number">9</span> Uncertainty estimation</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">10</span> References</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Flood Frequency Analysis (FFA) with Block-Maxima</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="libraries" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Libraries</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(trend)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extRemes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-bmdata" class="level1 page-columns page-full" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data import</h1>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Download the data used in this section
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://github.com/diopBachir/tp_eva/blob/master/blockmaxima/data/discharge.csv" download="" class="download-btn">üì• Download CSV</a></p>
</div>
</div>
<p>Let‚Äôs consider the formatted daily streamflow data file for the target catchment. We can read the data into a data frame using the <code>read.csv()</code> function. We will also set the column names using the <code>col.names</code> argument, and use the <code>lubridate</code> library to prepare a time serie.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="st">"./data/discharge.csv"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>Qdata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(filename, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Q"</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># construct time serie</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>Qdata<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">paste</span>(Qdata[[<span class="st">"Year"</span>]], Qdata[[<span class="st">"Month"</span>]], Qdata[[<span class="st">"Day"</span>]], <span class="at">sep =</span> <span class="st">"-"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>Qdata<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(Qdata<span class="sc">$</span>Date)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># final time serie</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>Qdata <span class="ot">&lt;-</span> Qdata[, <span class="fu">c</span>(<span class="st">"Date"</span>, <span class="st">"Q"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output is a data frame (or a matrix) with 22799 rows and 2 columns.</p>
<div class="cell">
<div id="tbl-bm_loaddata" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bm_loaddata-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: First (6) lines of the daily streamflow data for Block-Maxima approach
</figcaption>
<div aria-describedby="tbl-bm_loaddata-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">Date</th>
<th style="text-align: center;">Q</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">22794</td>
<td style="text-align: center;">2020-12-26</td>
<td style="text-align: center;">2.326204</td>
</tr>
<tr class="even">
<td style="text-align: left;">22795</td>
<td style="text-align: center;">2020-12-27</td>
<td style="text-align: center;">2.173519</td>
</tr>
<tr class="odd">
<td style="text-align: left;">22796</td>
<td style="text-align: center;">2020-12-28</td>
<td style="text-align: center;">2.193727</td>
</tr>
<tr class="even">
<td style="text-align: left;">22797</td>
<td style="text-align: center;">2020-12-29</td>
<td style="text-align: center;">2.090440</td>
</tr>
<tr class="odd">
<td style="text-align: left;">22798</td>
<td style="text-align: center;">2020-12-30</td>
<td style="text-align: center;">1.966944</td>
</tr>
<tr class="even">
<td style="text-align: left;">22799</td>
<td style="text-align: center;">2020-12-31</td>
<td style="text-align: center;">1.854676</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We can display the structure of the data frame using the <code>str()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Qdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   22799 obs. of  2 variables:
 $ Date: Date, format: "1958-08-01" "1958-08-02" ...
 $ Q   : num  0.236 0.184 0.144 0.144 0.144 ...</code></pre>
</div>
</div>
</div>
</div>
</div></div></section>
<section id="extreme-events-sampling" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Extreme events sampling</h1>
<section id="the-block-maxima-approach" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="the-block-maxima-approach"><span class="header-section-number">3.1</span> The block maxima approach</h2>
<p>The <strong>Block-Maxima Approach <span class="citation" data-cites="gumbel1958statistics">(<a href="#ref-gumbel1958statistics" role="doc-biblioref">Gumbel, 1958</a>)</span></strong>, consists of sampling the maximum streamflow value for each year (or block). This method is straightforward to implement and reduce the possiblity of serial dependence.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-bm_illust" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bm_illust-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-bm_illust-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bm_illust-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Illustration of the Block-Maxima Approach: Daily Streamflow with Yearly Maxima
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="exract-annual-maximum-floods-amf-from-the-daily-streamflow-serie" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="exract-annual-maximum-floods-amf-from-the-daily-streamflow-serie"><span class="header-section-number">3.2</span> Exract annual maximum floods (AMF) from the daily streamflow serie</h2>
<p><strong>1.</strong> To extract annual maximum floods (AMF) from the streamflow series, we need to define a function that returns the maximum value of a block of data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>extract_annual_max <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(Date)) <span class="sc">%&gt;%</span> <span class="co"># extract year from Date</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Q <span class="sc">==</span> <span class="fu">max</span>(Q)) <span class="sc">%&gt;%</span> <span class="co"># keep only max flow per year</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="co"># in case of ties, keep first max</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(Year, Date, <span class="at">AMAX =</span> Q)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>2.</strong> Now, we apply the function to the data to extract AMF for each year:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>extractedAMF <span class="ot">&lt;-</span> <span class="fu">extract_annual_max</span>(Qdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div id="tbl-bm_extract" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bm_extract-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: First (6) rows of the AMF extracted using the Block-Maxima approach
</figcaption>
<div aria-describedby="tbl-bm_extract-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">Year</th>
<th style="text-align: center;">Date</th>
<th style="text-align: center;">AMAX</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1958</td>
<td style="text-align: center;">1958-12-20</td>
<td style="text-align: center;">39.96984</td>
</tr>
<tr class="even">
<td style="text-align: center;">1959</td>
<td style="text-align: center;">1959-03-07</td>
<td style="text-align: center;">36.89593</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1960</td>
<td style="text-align: center;">1960-10-06</td>
<td style="text-align: center;">58.41780</td>
</tr>
<tr class="even">
<td style="text-align: center;">1961</td>
<td style="text-align: center;">1961-12-11</td>
<td style="text-align: center;">18.44796</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1962</td>
<td style="text-align: center;">1962-03-05</td>
<td style="text-align: center;">19.47185</td>
</tr>
<tr class="even">
<td style="text-align: center;">1963</td>
<td style="text-align: center;">1963-04-11</td>
<td style="text-align: center;">29.21002</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="display-sampled-events" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="display-sampled-events"><span class="header-section-number">3.3</span> Display sampled events</h2>
<p>Now, we overlap the extracted <strong>Annual Maximum Flow</strong> with the original daily discharge time serie to visualize the sampling process. We use the functions from the <code>dplyr</code> and <code>ggplot2</code> library to create the plot.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>amf.plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> Qdata, <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Q), <span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">size =</span> <span class="fl">0.7</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> extractedAMF, <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> AMAX), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Discharge (Q)"</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(amf.plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-amf_with_dailystreamflow" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-amf_with_dailystreamflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-amf_with_dailystreamflow-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-amf_with_dailystreamflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Daily streamflow time serie (blue) and with Extracted Annual Peak Floods (red) extracted using the Block-Maxima Approach
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="autocorrelation-testing" class="level1 page-columns page-full" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Autocorrelation testing</h1>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Recall
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>extractedAMF</code> variable used in the following code blocs is created previously in the <strong>Sampling Events</strong> section The <code>acf</code> function is a R-base function, no installation needed</p>
</div>
</div>
</div></div><section id="sec-autocorrelation" class="level2 page-columns page-full" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sec-autocorrelation"><span class="header-section-number">4.1</span> What is autocorrelation?</h2>
<p><strong><code>Autocorrelation (or autocovariance)</code></strong> refers to the fact that in a time or spatial serie, the measurement of a phenomenon at time t can be correlated with previous measurements (at time t-1, t-2, t-3, etc.) or with subsequent measurements (at t+1, t+2, t+3, ‚Ä¶). An autocorrelated series is thus correlated with itself, with a given lag (please refer <a href="https://perso.ens-lyon.fr/lise.vaudor/autocorrelation-de-series-temporelles-ou-spatiales/">here</a> for more details).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
To assess autocorrelation, two methods will be used in this lab
</div>
</div>
<div class="callout-body-container callout-body">
<p>üîç <strong>Correlogram:</strong></p>
<ul>
<li>Visualization of correlation coefficients between the serie and its lags</li>
<li>Based on the <a href="https://medium.com/@kis.andras.nandor/understanding-autocorrelation-and-partial-autocorrelation-functions-acf-and-pacf-2998e7e1bcb5">autocorrelation function (ACF)</a></li>
<li>Helps identify the presence and extent of dependencies over time</li>
</ul>
<p>üìä <strong>Wald-Wolfowitz Test <span class="citation" data-cites="wald_test_1940">(<a href="#ref-wald_test_1940" role="doc-biblioref">Wald &amp; Wolfowitz, 1940</a>)</span>:</strong></p>
<ul>
<li>Non-parametric to assess the randomness of a time serie</li>
<li>Used to detect the absence of randomness in the serie</li>
<li><strong>Null hypothesis: The sequence of observations is random</strong></li>
</ul>
</div>
</div>
<section id="correlogram" class="level3 page-columns page-full" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="correlogram"><span class="header-section-number">4.1.1</span> Correlogram</h3>
<p>If you execute the above given chunk, it generates the <a href="#fig-acfplot" class="quarto-xref">Figure&nbsp;3</a> as output:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute autocorrelation lag</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>bacf <span class="ot">&lt;-</span> <span class="fu">acf</span>(extractedAMF<span class="sc">$</span>AMAX, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>bacfdf <span class="ot">&lt;-</span> <span class="fu">with</span>(bacf, <span class="fu">data.frame</span>(lag, acf))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># confidence interval</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(extractedAMF<span class="sc">$</span>AMAX)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>conf_limit <span class="ot">&lt;-</span> <span class="fl">1.96</span> <span class="sc">/</span> <span class="fu">sqrt</span>(n)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># correlogram</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> bacfdf, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> acf)) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">width =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> conf_limit, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span>conf_limit, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"ACF"</span>, <span class="at">x =</span> <span class="st">"Lag"</span>) <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">family =</span> <span class="st">"Times"</span>),</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">family =</span> <span class="st">"Times"</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-acfplot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-acfplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-acfplot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-acfplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Autocorrelation (at different lags) of Annual Maximum Flood (AMAX). The red line represents the 95% confidence interval.
</figcaption>
</figure>
</div>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interpretation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Looking at the 95% confidence interval bounds in the correlogram, we can see that from lag -1 to lag-16, the autocorrelation is only significant at lag-8, so we can conclude that the maximum annual flood is a random variable.</p>
</div>
</div>
</div></div></section>
<section id="sec-wwtest" class="level3 page-columns page-full" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="sec-wwtest"><span class="header-section-number">4.1.2</span> Wald-Wolfowitz (WW) test</h3>
<p>In the chunk below, we use the <code>ww.test(...)</code> function from <code>{trend}</code> package to perform the <code>WW test</code> at the <strong>0.05 significance level</strong>, to test the hypothesis that the maximum annual flood is a random variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>wwtest <span class="ot">&lt;-</span> trend<span class="sc">::</span><span class="fu">ww.test</span>(extractedAMF<span class="sc">$</span>AMAX)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(wwtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wald-Wolfowitz test for independence and stationarity

data:  extractedAMF$AMAX
z = 0.73738, n = 60, p-value = 0.4609
alternative hypothesis: The series is significantly different from 
 independence and stationarity</code></pre>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interpretation
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong><code>p.value = 0.4609:</code></strong> indicates that the data series appears to be consistent with the assumption of independence and stationarity (i.e., there is not enough evidence to reject the null hypothesis of randomness).</p>
</div>
</div>
</div></div></section>
</section>
</section>
<section id="sec-trend" class="level1 page-columns page-full" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Trend detection</h1>
<section id="non-parametric-methods" class="level2 page-columns page-full" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="non-parametric-methods"><span class="header-section-number">5.1</span> Non-parametric methods</h2>
<section id="sec-mk" class="level3 page-columns page-full" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="sec-mk"><span class="header-section-number">5.1.1</span> The Mann-Kendall (MK) test</h3>
<p>The MK test‚Äôs null hypothesis (H0) assumes no trend in the data <span class="citation" data-cites="mann1945nonparametric kendall_rank_1975">(<a href="#ref-mann1945nonparametric" role="doc-biblioref">Mann, 1945</a>; <a href="#ref-kendall_rank_1975" role="doc-biblioref">Kendall, 1975</a>)</span>. Recommended by the World Meteorological Organization (WMO), it is simple and requires no assumptions about data distribution, which is particularly advantageous for hydroclimatic series that <strong>are rarely normally distributed</strong>. Additionally, outlier values have very little influence on the results. The Mann-Kendall test statistic <span class="math inline">S</span> is defined as:</p>
<p><span class="math display">
S = \sum_{i=1}^{n-1} \sum_{j=i+1}^{n} \text{sgn}(x_j - x_i) \tag{1}
</span></p>
<p>The sign function <span class="math inline">sgn())</span> is given by:</p>
<p><span class="math display">
\text{sgn}(x_j - x_i) =
\begin{cases}
+1 &amp; \text{if } (x_j - x_i) &gt; 0 \\
0 &amp; \text{if } (x_j - x_i) = 0 \\
-1 &amp; \text{if } (x_j - x_i) &lt; 0
\end{cases} \tag{2}
</span></p>
<p>where <span class="math inline">x_i</span> and <span class="math inline">x_j</span> are values of the variable at time <span class="math inline">i</span> and <span class="math inline">j</span>, respectively, and <span class="math inline">n</span> is the total number of observations.</p>
<p>A significance level (commonly <span class="math inline">\alpha = 0.05</span>) and the trend slope indicating the direction and magnitude of the trend are key characteristics of the Mann-Kendall test. If <span class="math inline">n &gt; 8</span>, the test statistic <span class="math inline">S</span> approximates a normal distribution. In this case, the mean of <span class="math inline">S</span> is zero and its variance is:</p>
<p><span class="math display">
\text{var}(S) = \frac{n(n - 1)(2n + 5)}{18} \tag{3}
</span></p>
<p>The standardized test statistic <span class="math inline">Z</span>, which indicates the direction of the trend, is calculated as:</p>
<p><span class="math display">
Z =
\begin{cases}
\frac{S - 1}{\sqrt{\text{var}(S)}} &amp; \text{if } S &gt; 0 \\
0 &amp; \text{if } S = 0 \\
\frac{S + 1}{\sqrt{\text{var}(S)}} &amp; \text{if } S &lt; 0
\end{cases} \tag{4}
</span></p>
<p>The null hypothesis <span class="math inline">H_0</span> (no trend) is rejected if <span class="math inline">|Z| &gt; 1.96</span> at the 95% confidence level.</p>
<ul>
<li>A <strong>positive trend</strong> is significant if <span class="math inline">Z &gt; 1.96</span></li>
<li>A <strong>negative trend</strong> is significant if <span class="math inline">Z &lt; -1.96</span></li>
</ul>
<p>We use the <code>mk.test(...)</code> function from <code>{trend}</code> package to perform the <code>MK test</code> at the <strong>0.05 significance level</strong> to test the hypothesis that there is no stationarity in the maximum annual floods serie.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong><code>Non-Stationarity (NS)</code></strong> refers to changes in statistical properties over time.</p>
</div>
</div>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mktest <span class="ot">&lt;-</span> trend<span class="sc">::</span><span class="fu">mk.test</span>(extractedAMF<span class="sc">$</span>AMAX)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mktest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Mann-Kendall trend test

data:  extractedAMF$AMAX
z = -1.231, n = 60, p-value = 0.2183
alternative hypothesis: true S is not equal to 0
sample estimates:
            S          varS           tau 
 -194.0000000 24581.3333333    -0.1096665 </code></pre>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interpretation
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong><code>p.value = 0.2183:</code></strong> there is not enough statistical evidence to conclude that a significant trend exists in the AMF serie.</p>
<p><strong><code>tau = -0.1096665:</code></strong> Kendall‚Äôs Tau is a non-parametric measure of trend strength, ranging from -1 (perfect decreasing trend) to +1 (perfect increasing trend). A value near 0 indicates a weak or no trend.</p>
<p><strong><code>z = -1.231:</code></strong> the calculated test statistic (a z-score). A negative value suggests a potential decreasing trend, while a positive value suggests a potential increasing trend.</p>
</div>
</div>
</div></div><p><a href="#fig-amfevolution" class="quarto-xref">Figure&nbsp;4</a> shows the evolution of the AMF over time and a red line indicating the overall linear trend. The Mann-Kendall test result (p-value = 0.2183) indicates that this visually apparent (decreasing) linear trend is not statistically significant at the 0.05 significance level.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>lineplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(extractedAMF, <span class="fu">aes</span>(Year, AMAX)) <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lineplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-amfevolution" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-amfevolution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-amfevolution-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-amfevolution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Evolution of the annual peak flood over time.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-sens" class="level3 page-columns page-full" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="sec-sens"><span class="header-section-number">5.1.2</span> Sen‚Äôs slope estimator</h3>
<p>The <strong>non-parametric method of Sen <span class="citation" data-cites="Sen1968">(<a href="#ref-Sen1968" role="doc-biblioref">1968</a>)</span></strong>, also referred to as the <strong>Theil‚ÄìSen estimator</strong>, is commonly combined with the Mann-Kendall test to estimate the slope <span class="math inline">(\beta)</span> of the of a trend. Sen‚Äôs algorithm looks at every pair of data points, calculates the slope between them, then uses the the median of all those slopes as the estimated trend.</p>
<p><span class="math display">
\beta = \text{median} \left( \frac{x_j - x_i}{j - i} \right), \quad , ‚àÄ\quad j &gt; i \tag{5}
</span></p>
<p>To express the Sen‚Äôs slope as a <strong>percentage change over the period</strong>, it can be normalized by the mean:</p>
<p><span class="math display">
\%\beta = \left( N \cdot \frac{\beta}{\bar{x}} \right) \times 100 \tag{6}
</span> where <span class="math inline">\%\beta</span> is the relative trend rate over the period, and <span class="math inline">\bar{x}</span> represents the mean value of the variable across the period, <span class="math inline">N</span> is the number of data points (i.e., the length of period).</p>
<p>The Sen‚Äôs slope can be easily computed using the <code>sens.slope(...)</code> function from the <code>{trend}</code> package, as in the chunk below:</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sen slope
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong><code>Slope = -0.1187375 :</code></strong> the median trend is slightly negative, suggesting a weak decline of <span class="math inline">-0.11 \quad mm/year</span>.</p>
<p><strong><code>p-value = 0.2183:</code></strong> this negative trend is not statistically significant.</p>
</div>
</div>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute Sen's slope and intercept</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>senslope <span class="ot">&lt;-</span> trend<span class="sc">::</span><span class="fu">sens.slope</span>(<span class="at">x =</span> extractedAMF<span class="sc">$</span>AMAX)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(senslope)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Sen's slope

data:  extractedAMF$AMAX
z = -1.231, n = 60, p-value = 0.2183
alternative hypothesis: true z is not equal to 0
95 percent confidence interval:
 -0.3115676  0.0768529
sample estimates:
Sen's slope 
 -0.1187375 </code></pre>
</div>
</div>
<p>Yet, the <code>sens.slope(...)</code> function returns the <strong>absolute</strong> slope (i.e., the median change per time unit). It is more meaningful to express the trend as a <strong>relative percentage</strong> change over the time period.</p>
<p>To do this, we define a <strong>wrapper function</strong> that calculates the Sen‚Äôs slope and then converts it into a relative trend rate.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>sens_slope_percent <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">time_step =</span> <span class="cn">NULL</span>) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#' Compute Sen's slope as a percentage change over the full time period</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#' @param x A numeric vector of observations</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#' @param time_step Optional (e.g., year) used for display purpose only</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#' @return Relative percent change over the period</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span>(trend)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    N <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">sens.slope</span>(x)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    slope <span class="ot">&lt;-</span> result<span class="sc">$</span>estimates <span class="co"># Absolute slope (per time unit)</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    p_val <span class="ot">&lt;-</span> result<span class="sc">$</span>p.value <span class="co"># p-value for trend test</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    mean_val <span class="ot">&lt;-</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    percent_change <span class="ot">&lt;-</span> (N <span class="sc">*</span> slope) <span class="sc">/</span> mean_val <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Absolute Sen's slope: "</span>, <span class="fu">round</span>(slope, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"P-value: "</span>, <span class="fu">format.pval</span>(p_val, <span class="at">digits =</span> <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Relative trend rate: "</span>, <span class="fu">round</span>(percent_change, <span class="dv">2</span>), <span class="st">"%"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, we can compute the <strong>relative Sen‚Äôs slope</strong> for the annual maximum flow data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute Sen's slope as a percentage change</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sens_slope_percent</span>(extractedAMF<span class="sc">$</span>AMAX, <span class="at">time_step =</span> <span class="st">"year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Absolute Sen's slope: -0.1187
P-value: 0.2183
Relative trend rate: -23.97%</code></pre>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Relative Sen‚Äôs slope
</div>
</div>
<div class="callout-body-container callout-body">
<p>The annual maximum flow shows a decreasing trend of ‚àí24% relative to its long-term average.</p>
</div>
</div>
</div></div></section>
</section>
<section id="parametric-methods" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="parametric-methods"><span class="header-section-number">5.2</span> Parametric methods</h2>
<p>Parametric methods rely on the adjustment of distributions adapted to extremes event (e.g., Generalized Extreme Value, Generalized Pareto Distribution, etc.) in a <code>non-stationary (NS)</code> context.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>NS is taken into account by allowing the models parameters to vary as a linear function of time or other covariates. Here, the location parameter <strong><code>(Œº)</code></strong> will be expressed as a linear function of time, denoted as <strong><code>Œº(t)</code></strong>, leaving the others parameters constant.</p>
</div>
</div>
</section>
</section>
<section id="flood-frequency-analysis-ffa" class="level1 page-columns page-full" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Flood frequency analysis (FFA)</h1>
<section id="probability-distributions" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="probability-distributions"><span class="header-section-number">6.1</span> Probability distributions</h2>
<p>We will compare two probability distributions adapted to the <strong><code>Block-Maxima Framework</code></strong>: the <strong>Generalized Extreme Value (GEV)</strong> and the <strong>Gumbel</strong> probability distributions.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
GEV distribution
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Generalized Extreme Value (GEV) distribution is a family of continuous probability distributions developed to combine the <strong>Gumbel</strong>, <strong>Fr√©chet</strong>, and <strong>Weibull</strong> distributions. According to the <a href="../overview/index.qmd#sec-evt"><strong>Extreme Value Theorem</strong></a>, the <strong>GEV</strong> distribution is the only possible limit distribution for properly normalized sequences of maxima of independent and identically distributed random variables. The <strong>cumulative distribution function (CDF)</strong> of the <strong>GEV</strong> distribution is given by:</p>
<p><span class="math display">
F(x; \mu, \alpha, \xi) = \exp\left\{ -\left[ 1 + \xi \left( \frac{x - \mu}{\alpha} \right) \right]^{-1/\xi} \right\}
\tag{7}
</span></p>
<p>for <span class="math inline">1 + \xi (x - \mu)/\alpha &gt; 0</span>, where, <span class="math inline">\mu</span> is the location parameter, <span class="math inline">\alpha &gt; 0</span> is the scale parameter, and <span class="math inline">\xi</span> is the shape parameter.</p>
<p>The shape parameter <span class="math inline">\xi</span> determines the type of extreme value distribution:</p>
<ul>
<li>If <span class="math inline">\xi &gt; 0</span>, the distribution is a Fr√©chet type.</li>
<li>If <span class="math inline">\xi &lt; 0</span>, the distribution is a Weibull type.</li>
<li>If <span class="math inline">\xi = 0</span>, the distribution is a Gumbel type.</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Gumbel distribution
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>Gumbel</strong> distribution is a special case of the GEV distribution when the shape parameter <span class="math inline">\xi = 0</span>. It is often used to model the distribution of the maximum (or minimum) of a number of samples of various distributions. The <strong>cumulative distribution function (CDF)</strong> of the <strong>Gumbel</strong> distribution is given by:</p>
<p><span class="math display">
F(x; \mu, \alpha) = \exp\left\{ -\exp\left[ -\frac{x - \mu}{\alpha} \right] \right\}
\tag{8}
</span> where <span class="math inline">\mu</span> is the location parameter, <span class="math inline">\alpha &gt; 0</span> is the scale parameter, and <span class="math inline">x</span> is the variable</p>
</div>
</div>
</section>
<section id="models-fitting" class="level2 page-columns page-full" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="models-fitting"><span class="header-section-number">6.2</span> Models fitting</h2>
<p>We will employ the <strong><code>Generalized Maximum Likelihood Estimation (GMLE)</code></strong> method to fit probability distributions to our data. The <strong><code>{extRemes}</code></strong> package offers the function <strong><code>fevd(..)</code></strong>, which enables fitting a range of probability distributions ‚Äî such as the <strong>GEV</strong>, <strong>Gumbe</strong>l distributions ‚Äî to a given dataset using three distinct fitting methods: <strong><code>L-moments</code></strong>, <strong><code>Maximum Likelihood Estimation (MLE)</code></strong>, and <strong><code>GMLE</code></strong>.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why the <strong><code>GML</code></strong> method?
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong><code>GMLE</code></strong> method use a prior distribution to constrain the <strong><code>GEVC shape parameter</code></strong> within a reasonnable interval . This prior helps avoid unrealistic or extreme negative values of the shape parameter, leading to more reliable and stable parameter estimates when data are limited (See <a href="https://agupubs.onlinelibrary.wiley.com/doi/10.1029/1999WR900330"><strong><code>Martins &amp; Stedinger (2000)</code></strong></a> for more details).</p>
</div>
</div>
</div></div><p>The advantage of using <strong><code>GMLE</code></strong> and <strong><code>MLE</code></strong> over the <strong><code>L-moments</code></strong> method is that <strong><code>L-moments</code></strong> are limited in their ability to accommodate non-stationary processes. In contrast, <strong><code>GMLE</code></strong> and <strong><code>MLE</code></strong> can directly incorporate covariates or time trends, making them more flexible and suitable for analyzing data where the underlying distribution may change over time or as a function of external variables. This flexibility is especially important for trend detection.</p>
</section>
<section id="model-selection" class="level2 page-columns page-full" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="model-selection"><span class="header-section-number">6.3</span> Model selection</h2>
<p>To select the best probability distribution, we will use the <strong><code>AIC</code></strong> and <strong><code>AIC</code></strong> criteria. The model with the <strong>lowest</strong> <strong><code>AIC</code></strong> and <strong><code>BIC</code></strong> values is the best-suited model. <strong><code>AIC</code></strong> tends to favor models with better fit, even if more complex, while <strong><code>BIC</code></strong> favors simpler models, especially as sample size grows. Combining these these performance metrics enhances the efficiency of model selection.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Joint use of AIC and BIC
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>if both criteria select the same model, it is strongly preferred</li>
<li>if not, the choice depends on whether your goal is <strong>predictive accuracy (AIC)</strong> or <strong>model simplicity (BIC)</strong></li>
</ul>
</div>
</div>
</div></div><div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
AIC (Akaike Information Criterion)
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong><code>AIC</code></strong> balances the goodness of fit of the model with the number of parameters used by the model. This mean that it rewards models that fit the data well but also penalizes models that use too many parameters. The formula for AIC is:</p>
<p><span class="math display">
\text{AIC} = 2k - 2\ln(\hat{L}) \tag{9}
</span> where <span class="math inline">k</span> is the number of parameters in the model, <span class="math inline">\hat{L}</span> is the maximum value of the <a href="https://en.wikipedia.org/wiki/Likelihood_function">likelihood function</a> for the model.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
BIC (Bayesian Information Criterion)
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong><code>BIC</code></strong> penalizes model complexity <strong>more heavily than <code>AIC</code></strong>, especially for larger sample sizes. This means <strong><code>BIC</code></strong> tends to favor simpler models compared to AIC. The formula for BIC is: <span class="math display">
\text{BIC} = k\ln(n) - 2\ln(\hat{L}) \tag{10}
</span> where: <span class="math inline">k</span> is the number of parameters in the model, <span class="math inline">n</span> is the number of data points, and <span class="math inline">\hat{L}</span> is the maximum value of the <a href="https://en.wikipedia.org/wiki/Likelihood_function">likelihood function</a> for the model.</p>
</div>
</div>
</section>
<section id="perform-ffa" class="level2 page-columns page-full" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="perform-ffa"><span class="header-section-number">6.4</span> Perform FFA</h2>
<section id="sec-utils" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="sec-utils"><span class="header-section-number">6.4.1</span> Setup utils</h3>
<p>To pretty-print the summary of our models‚Äô fitting, we will create a custom function that will take the fitted model as an argument, extract and format key components of the fiited object, and print the output:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>pretty_fit_summary <span class="ot">=</span> <span class="cf">function</span>(fitobj, model) {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' Pretty print summary of a  extreme value model fit</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#'</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param fitobj Fitted model object from extRemes::fevd()</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#' @param model Character string describing the model (e.g., "GEV")</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"==="</span>, model, <span class="st">" Fit Summary ===</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Estimated Parameters</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Estimated Parameters:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">=</span> fitobj<span class="sc">$</span>results<span class="sc">$</span>par</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">round</span>(params, <span class="dv">4</span>))</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Log-likelihood, AIC, and BIC</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  look <span class="ot">=</span> <span class="fu">summary</span>(fitobj, <span class="at">silent=</span><span class="cn">TRUE</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Model Fit Criteria:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"LogLik: %.2f</span><span class="sc">\n</span><span class="st">"</span>, look<span class="sc">$</span>nllh))</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"AIC: %.2f</span><span class="sc">\n</span><span class="st">"</span>, look<span class="sc">$</span>AIC))</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"BIC: %.2f</span><span class="sc">\n</span><span class="st">"</span>, look<span class="sc">$</span>BIC))</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return the AIC and BIC values for further comparison</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">Model=</span>model, <span class="at">Crit=</span><span class="fu">c</span>(<span class="st">"AIC"</span>, <span class="st">"BIC"</span>), <span class="at">Value=</span><span class="fu">c</span>(look<span class="sc">$</span>AIC, look<span class="sc">$</span>BIC)))</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distributions-fitting" class="level3 page-columns page-full" data-number="6.4.2">
<h3 data-number="6.4.2" class="anchored" data-anchor-id="distributions-fitting"><span class="header-section-number">6.4.2</span> Distributions fitting</h3>
<section id="stationary-context" class="level4 page-columns page-full" data-number="6.4.2.1">
<h4 data-number="6.4.2.1" class="anchored" data-anchor-id="stationary-context"><span class="header-section-number">6.4.2.1</span> Stationary context</h4>
<div class="tabset-margin-container page-columns page-full"><div class="no-row-height column-margin column-container"><div class="tabset-margin-content tabset-1-1-tab-margin-content">
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What about the parameters?
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong><code>location = 19.4868:</code></strong> is the <strong><code>central tendency (Œº)</code></strong> of the GEV distribution. It defines the central position of the distribution and serves as a baseline around which extreme values are distributed.</p>
<p><strong><code>scale = 9.932:</code></strong> reflects the spread or variability of the extreme values. In our case, the AMF distribution has moderate spread around the shifting central value <strong><code>Œº(t)</code></strong>.</p>
<p><strong><code>shape = 0.3576:</code></strong> this positive shape parameter implies a Fr√©chet-type (heavy-tailed) distribution. This means there is greater probability of very large flood events compared to a Gumbel (shape = 0) or Weibull (shape &lt; 0) distribution.</p>
</div>
</div>
</div><div class="tabset-margin-content tabset-1-3-tab-margin-content collapse">
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
‚úÖ Best-suited: GEV
</div>
</div>
<div class="callout-body-container callout-body">
<p>Both <strong>AIC and BIC are lower for the GEV model</strong>, which suggests that it provides a better balance of fit and complexity than the Gumbel model.</p>
</div>
</div>
</div></div></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true"><span class="custom-tabset-title2">GEV fitting</span></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false"><span class="custom-tabset-title2">Gumbel fitting</span></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false"><span class="custom-tabset-title2">Best-suited model</span></a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>The chunk below use the <strong><code>{extRemes}</code></strong> library to fit the GEV distribution to the <strong>Annual Maximum Floods</strong> extracted earlier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the GEV distribution to the AMF</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extRemes)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>gevfit <span class="ot">=</span> <span class="fu">fevd</span>(<span class="at">x=</span>extractedAMF<span class="sc">$</span>AMAX, <span class="at">type=</span><span class="st">"GEV"</span>, <span class="at">method=</span><span class="st">"GMLE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we will print the results of the fit, using the <strong><code>pretty_fit_summary()</code></strong> function we have defined above. This will show the <strong>AIC</strong> and <strong>BIC</strong> values, as well as the estimated parameters of the fitted GEV distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show fitting sumary</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>gevfit_res <span class="ot">=</span> <span class="fu">pretty_fit_summary</span>(gevfit, <span class="st">"GEV"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== GEV  Fit Summary ===

Estimated Parameters:
location    scale    shape 
 19.4868   9.8254   0.3818 

Model Fit Criteria:
LogLik: 244.65
AIC: 495.31
BIC: 501.59</code></pre>
</div>
</div>

<p>Finally, we show in <a href="#fig-gevfitdiag-stationary" class="quarto-xref">Figure&nbsp;5</a>, the diagnostics from the GEV distribution fitted to the Annual Maximum Floods: density plot of empirical data and fitted GEV df (top-left), and quantiles from a sample drawn from the fitted GEV against the empirical data quantiles with 95% confidence bands (top-right).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show diagnostic plots of the GEV distribution fitting</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gevfit, <span class="at">type=</span><span class="st">"density"</span>, <span class="at">main=</span><span class="st">"(a) Density plot"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">043</span>))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gevfit, <span class="at">type=</span><span class="st">"qq2"</span>, <span class="at">main=</span><span class="cn">NULL</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main=</span><span class="st">"(b) Q-Q plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gevfitdiag-stationary" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gevfitdiag-stationary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-gevfitdiag-stationary-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gevfitdiag-stationary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Diagnostic plots for the Generalized Extreme Value (GEV) distribution fitted to the Annual Maximum Flood (AMF) series in a Stationary Context
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>The chunk below use the <strong><code>{extRemes}</code></strong> library to fit the Gumbel distribution to the <strong>Annual Maximum Floods</strong> extracted earlier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the Gumbel distribution to the AMF</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>gumfit <span class="ot">=</span> <span class="fu">fevd</span>(<span class="at">x=</span>extractedAMF<span class="sc">$</span>AMAX, <span class="at">type=</span><span class="st">"Gumbel"</span>, <span class="at">method=</span><span class="st">"GMLE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we will print the results of the fit, using the <strong><code>pretty_fit_summary()</code></strong> function we have defined previously. This will show the <strong>AIC</strong> and <strong>BIC</strong> values, as well as the estimated parameters of the fitted Gumbel distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show fitting sumary</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>gumfit_res <span class="ot">=</span> <span class="fu">pretty_fit_summary</span>(gumfit, <span class="st">"Gumbel"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Gumbel  Fit Summary ===

Estimated Parameters:
location    scale 
 21.7606  12.3003 

Model Fit Criteria:
LogLik: 249.40
AIC: 502.80
BIC: 506.99</code></pre>
</div>
</div>
<p>Finally, we show in <a href="#fig-gumfitdiag-stationary" class="quarto-xref">Figure&nbsp;6</a>, the diagnostics from the Gumbel distribution fitted to the Annual Maximum Floods:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show diagnostic plots of the GEV distribution fitting</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gumfit, <span class="at">type=</span><span class="st">"density"</span>, <span class="at">main=</span><span class="st">"(a) Density plot"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">035</span>))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gumfit, <span class="at">type=</span><span class="st">"qq2"</span>, <span class="at">main=</span><span class="cn">NULL</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main=</span><span class="st">"(b) Q-Q plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gumfitdiag-stationary" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gumfitdiag-stationary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-gumfitdiag-stationary-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gumfitdiag-stationary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Diagnostic plots for the Gumbel distribution fitted to the Annual Maximum Flood (AMF) series in a Stationary Context
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>As mentionned previously, the model with the lowest <strong><code>AIC</code></strong> and <strong><code>BIC</code></strong> values is the best-suited model. The <strong><code>pretty_fit_summary()</code></strong> function we have defined previously return a data.frame of <strong>AIC</strong> and <strong>BIC</strong> values for each distribution. Lets compare these values to select the best-suited distribution for the next steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gevfit_res)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gumfit_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tbl-bm_aicbictable" class="quarto-layout-panel anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bm_aicbictable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Table of AIC and BIC values for each distribution
</figcaption>
<div aria-describedby="tbl-bm_aicbictable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-bm_aicbictable" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-bm_aicbictable-1" class="do-not-create-environment quarto-float anchored">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-bm_aicbictable-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) GEV
</figcaption>
<div aria-describedby="tbl-bm_aicbictable-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-bm_aicbictable-1" class="do-not-create-environment table">
<thead>
<tr class="header">
<th style="text-align: center;">Model</th>
<th style="text-align: center;">Crit</th>
<th style="text-align: center;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">GEV</td>
<td style="text-align: center;">AIC</td>
<td style="text-align: center;">495.3076</td>
</tr>
<tr class="even">
<td style="text-align: center;">GEV</td>
<td style="text-align: center;">BIC</td>
<td style="text-align: center;">501.5907</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-bm_aicbictable" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-bm_aicbictable-2" class="do-not-create-environment quarto-float anchored">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-bm_aicbictable-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Gumbel
</figcaption>
<div aria-describedby="tbl-bm_aicbictable-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-bm_aicbictable-2" class="do-not-create-environment table">
<thead>
<tr class="header">
<th style="text-align: center;">Model</th>
<th style="text-align: center;">Crit</th>
<th style="text-align: center;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Gumbel</td>
<td style="text-align: center;">AIC</td>
<td style="text-align: center;">502.7966</td>
</tr>
<tr class="even">
<td style="text-align: center;">Gumbel</td>
<td style="text-align: center;">BIC</td>
<td style="text-align: center;">506.9853</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>

</div>
</div>
</div>
</section>
<section id="parametric-trend-detection" class="level4 page-columns page-full" data-number="6.4.2.2">
<h4 data-number="6.4.2.2" class="anchored" data-anchor-id="parametric-trend-detection"><span class="header-section-number">6.4.2.2</span> Parametric trend-detection</h4>
<p>When covariates are to be incorporated into EVA, a common approach to account for non-stationary is to incorporate covariates within the parameters of the distributions in a <strong><code>regression-like manner</code></strong>. To perform <strong>parametric trend detection</strong>, we model the <strong><code>location parameter (Œº)</code></strong> as a function of time, transforming the models into <strong><code>non-stationary distributions</code></strong>. The location parameter of the non-stationnary GEV and Gumbel is computed as follow: <span class="math display">
\mu (t) = \mu 0 + \mu 1¬∑t \tag{11}
</span> where <span class="math inline">\mu (t)</span> is the time-dependant location parameter, <span class="math inline">t</span> is the time index, <span class="math inline">\mu 0</span> is the intercept, and <span class="math inline">\mu 1</span> is the slope.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Trend?
</div>
</div>
<div class="callout-body-container callout-body">
<p>The decision to adopt a non-stationary (or more complex) model in FFA depends on whether the temporal trend is <strong><code>statistically significant</code></strong>.</p>
<p>The <strong><code>deviance test</code></strong>, based on <strong><code>likelihood ratio statistic</code></strong> <a href="https://link.springer.com/book/10.1007/978-1-4471-3675-0">(Coles, 2001)</a>, offers a formal approach to test this hypothesis by comparing the stationary and non-stationary models.</p>
</div>
</div>
<section id="creating-covariate" class="level5 page-columns page-full" data-number="6.4.2.2.1">
<h5 data-number="6.4.2.2.1" class="anchored" data-anchor-id="creating-covariate"><span class="header-section-number">6.4.2.2.1</span> Creating covariate</h5>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>As mentionned above, we use <strong>time index</strong> to account for trend in the AMF serie. We create in this chunk above a new column, <code>TimeIndex</code>, to be used as covariate.</p>
</div>
</div>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add time index to use for non-stationary context fitting</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>extractedAMF[[<span class="st">"TimeIndex"</span>]] <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(extractedAMF)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">tibble</span>(extractedAMF), <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 4
   Year Date        AMAX TimeIndex
  &lt;dbl&gt; &lt;date&gt;     &lt;dbl&gt;     &lt;int&gt;
1  1958 1958-12-20  40.0         1
2  1959 1959-03-07  36.9         2
3  1960 1960-10-06  58.4         3
4  1961 1961-12-11  18.4         4
5  1962 1962-03-05  19.5         5</code></pre>
</div>
</div>
</section>
<section id="non-stationary-gev-fitting" class="level5 page-columns page-full" data-number="6.4.2.2.2">
<h5 data-number="6.4.2.2.2" class="anchored" data-anchor-id="non-stationary-gev-fitting"><span class="header-section-number">6.4.2.2.2</span> Non-Stationary GEV fitting</h5>
<p>The chunk below use the <strong><code>{extRemes}</code></strong> library to fit the <strong><code>Non-Stationary GEV (NS-GEV) distribution</code></strong> to the <strong>Annual Maximum Floods</strong> extracted earlier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the GEV distribution to the AMF</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>extractedAMF <span class="ot">=</span> <span class="fu">data.frame</span>(extractedAMF)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>nsgevfit <span class="ot">=</span> <span class="fu">fevd</span>(<span class="at">x=</span>AMAX, <span class="at">location.fun=</span><span class="sc">~</span>TimeIndex, <span class="at">data=</span>extractedAMF, <span class="at">type=</span><span class="st">"GEV"</span>, <span class="at">method=</span><span class="st">"GMLE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we will print the results of the fit, using the <strong><code>pretty_fit_summary()</code></strong> function we have defined above. This will show the <strong>AIC</strong> and <strong>BIC</strong> values, as well as the estimated parameters of the fitted <strong><code>NS-GEV</code></strong> distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show fitting sumary</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>nsgevfit_res <span class="ot">=</span> <span class="fu">pretty_fit_summary</span>(nsgevfit, <span class="st">"GEV"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== GEV  Fit Summary ===

Estimated Parameters:
    mu0     mu1   scale   shape 
20.5045 -0.0276  9.9322  0.3576 

Model Fit Criteria:
LogLik: 244.55
AIC: 497.11
BIC: 505.48</code></pre>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What about the parameters?
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p><strong><code>mu0 = Œº0 = 20.5045:</code></strong> is the <strong><code>intercept</code></strong> of the time-varying location parameter. It represents the baseline magnitude of the annual maximum flood (AMF) at the starting point of the time serie.</p></li>
<li><p><strong><code>mu1 = Œº1 = ‚Äì0.0276:</code></strong> is the <strong><code>slope</code></strong> of the location parameter with respect to time. It indicates a decreasing trend in the location (i.e., central tendency) of the AMF over time. Specifically, for each unit increase in time (i.e., each year), the location parameter decreases by <span class="math inline">0.0276\,mm</span>. This suggests that the typical magnitude of extreme floods has been gradually declining over the observation period.</p></li>
</ul>
</div>
</div>
</div></div><p>Finally, we show in <a href="#fig-gevfitdiag-ns" class="quarto-xref">Figure&nbsp;7</a>, the diagnostics from the <strong><code>NS-GEV</code></strong> distribution fitted to the Annual Maximum Floods: density plot of empirical data and fitted GEV df (top-left), quantiles from a sample drawn from the fitted GEV against the empirical data quantiles with 95% confidence bands (top-right).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show diagnostic plots of the GEV distribution fitting</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nsgevfit, <span class="at">type=</span><span class="st">"density"</span>, <span class="at">main=</span><span class="st">"(a) Density plot"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">4</span>))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nsgevfit, <span class="at">type=</span><span class="st">"qq2"</span>, <span class="at">main=</span><span class="cn">NULL</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main=</span><span class="st">"(b) Q-Q plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gevfitdiag-ns" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gevfitdiag-ns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-gevfitdiag-ns-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gevfitdiag-ns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Diagnostic plots for the Non-Stationary Generalized Extreme Value (NS-GEV) distribution fitted to the Annual Maximum Flood (AMF) series
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-deviancetest" class="level5 page-columns page-full" data-number="6.4.2.2.3">
<h5 data-number="6.4.2.2.3" class="anchored" data-anchor-id="sec-deviancetest"><span class="header-section-number">6.4.2.2.3</span> Deviance test</h5>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mathematical of the deviance test
</div>
</div>
<div class="callout-body-container callout-body">
<p>As mentionned above, The <strong>Deviance test</strong>, or <strong>Likelihood Ratio (LR)</strong> test, compares two nested models ‚Äî typically, a simpler (stationary) model and a more complex (non-stationary) model. It helps determine if introducing additional parameters (such as a time-varying location parameter in a GEV model) leads to a statistically significant improvement in model fit.</p>
<p><span class="math display">
D = 2{log(ML_{NSGEV}) - log(ML_{SGEV})}
\tag{12}
</span></p>
<p><span class="math inline">D</span> represents the deviance test statistic value <span class="math inline">(D-statistic)</span>, <span class="math inline">log(ML_{NSGEV})</span> and <span class="math inline">log(ML_{SGEV})</span> are the maximised log-likelihood functions of the <span class="math inline">NSGEV</span> and the <span class="math inline">SGEV</span>, respectively.</p>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
log-likelihood function
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong><code>likelihood function</code></strong> itself measures how well a statistical model explains observed data by giving, for a set of parameters, the probability (or probability density) of observing the data under the model.</p>
</div>
</div>
</div></div><p>To perform the <strong><code>Deviance test</code></strong>, we can use the <strong><code>lr.test(...)</code></strong> of the <strong><code>{extRemes}</code></strong>. This function just requires the previous fitted objects of class <strong><code>‚Äúfevd‚Äù</code></strong> from the <strong><code>fevd(...)</code></strong> function:</p>
<ul>
<li><strong><code>gevfit</code></strong>: model with fewer parameters (stationary GEV model)</li>
<li><strong><code>nsgevfit</code></strong>model with more parameters (non-stationary GEV model)</li>
</ul>
<p>The null hypothesis of the <strong>Deviance test</strong> is that <strong>simpler model is sufficient</strong> ‚Äî i.e., no trend (e.g., the location parameter Œº is constant over time). Letting <strong><code>c.alpha</code></strong> be the <strong><code>(1 - alpha)</code></strong> quantile of the <strong><code>chi-square distribution</code></strong> with degrees of freedom equal to the difference in the number of model parameters, the null hypothesis that <span class="math inline">D = 0</span> is rejected if <span class="math inline">D &gt; c.alpha</span> (i.e., in favor of model Non-Stationary GEV model).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># applying the Deviance test</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lr.test</span>(<span class="at">x=</span>gevfit, <span class="at">y=</span>nsgevfit, <span class="at">alpha=</span><span class="fl">0.05</span>, <span class="at">df=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Likelihood-ratio Test

data:  extractedAMF$AMAXAMAX
Likelihood-ratio = 0.20007, chi-square critical value = 3.8415, alpha =
0.0500, Degrees of Freedom = 1.0000, p-value = 0.6547
alternative hypothesis: greater</code></pre>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interpretation
</div>
</div>
<div class="callout-body-container callout-body">
<p>üö´ We fail to reject the null hypothesis.</p>
<ul>
<li><strong><code>D-statistic (0.20)</code></strong> much smaller than the <strong><code>critical value (3.84)</code></strong>.</li>
<li><strong><code>p-value (0.6547)</code></strong> much larger than the <strong><code>significance level (0.05)</code></strong>.</li>
</ul>
</div>
</div>
</div></div><div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Trend significance
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is <strong>no significant evidence</strong> that the <strong>Non-Stationary GEV model (with a time-varying location parameter)</strong> provides a better fit than the <strong>stationary model</strong>. The trend is not statistically significant (p = 0.6547).</p>
</div>
</div>
</section>
</section>
</section>
</section>
</section>
<section id="trend-analysis-conclusions" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Trend analysis conclusions</h1>
<p>üîé <strong>Trend Detection Methods Used</strong></p>
<ul>
<li>Parametric: <strong><code>Non-stationary GEV model</code></strong> with <strong>time-varying location parameter</strong></li>
<li>Non-parametric: <strong><code>Mann-Kendall test</code></strong></li>
</ul>
<p>üö´ <strong>No Significant Trend Detected</strong></p>
<ul>
<li>Both methods consistently indicate <strong>no statistically significant trend</strong> in the annual maximum flow series.</li>
<li>The <strong>Likelihood Ratio Test</strong> showed a high p-value (0.65), and the <strong>Mann-Kendall test</strong> similarly returned a non-significant result (p = 0.22).</li>
</ul>
<p>‚úÖ <strong>Modeling Implication</strong></p>
<ul>
<li>The results support the use of a stationary GEV model.</li>
<li>There is <strong>no strong evidence</strong> of temporal change in flood extremes over the study period.</li>
</ul>
</section>
<section id="flood-quantiles-estimation" class="level1 page-columns page-full" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Flood quantiles estimation</h1>
<section id="stationary-context-1" class="level2 page-columns page-full" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="stationary-context-1"><span class="header-section-number">8.1</span> Stationary context</h2>
<p>To estimate <strong>return levels</strong> for given <strong>return periods</strong>, we can use the <strong><code>return.level(...)</code></strong> from the <strong><code>{extRemes}</code></strong> package:</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong><code>return level</code></strong> is the value expected to be exceeded on average <strong>once every T years</strong>.</p>
</div>
</div>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># specific return periods (e.g., 10, 20 years)</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>rperiods <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">100</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># compute return levels (with 95% confidence intervals)</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>rlevels <span class="ot">=</span> <span class="fu">return.level</span>(gevfit, <span class="at">return.period=</span>rperiods, <span class="at">do.ci=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print results</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rlevels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fevd(x = extractedAMF$AMAX, type = "GEV", method = "GMLE")

[1] "Normal Approx."

                      95% lower CI  Estimate 95% upper CI
2-year return level       19.60029  23.35205     27.10382
5-year return level       31.27812  39.37944     47.48076
10-year return level      38.73868  54.51701     70.29534
20-year return level      43.75679  73.73668    103.71657
50-year return level      43.88864 107.90748    171.92631
100-year return level     35.61747 142.77898    249.94049</code></pre>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong><code>gevfit object</code></strong> is the <strong><code>gevfit</code></strong> object returned by the <strong><code>fevd(...)</code></strong> function when we have fitted a the <strong>stationary GEV model</strong>.</p>
</div>
</div>
</div><div class="">
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
‚ö†Ô∏è Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>For simplicity and illsutration, we use the <strong>normal approximation method</strong> to compute confidence intervals for the estimated return levels. This method assumes the <strong>sampling distribution</strong> of the return level estimates is <strong>approximately normal</strong> (which becomes more reasonable with large sample sizes).</p>
<p><strong>For more robust intervals, consider using <code>bootstrap</code> methods.</strong></p>
</div>
</div>
</div></div>
</section>
<section id="non-stationary-context" class="level2 page-columns page-full" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="non-stationary-context"><span class="header-section-number">8.2</span> Non-Stationary context</h2>
<p>In non-stationary context, since the <strong>location parameter is time-dependent</strong>, <strong>return levels</strong> have to be calculated for each year over time period. We refer to this as <strong><code>‚Äúeffective‚Äù return levels</code></strong> The same <strong><code>return.level(...)</code></strong> from the <strong><code>{extRemes}</code></strong> package is used to compute <strong><code>"effective" return levels</code></strong>.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong><code>nsgevfit object</code></strong> is the object returned by the <strong><code>fevd(...)</code></strong> function when we have fitted a the <strong>non-stationary GEV model</strong>.</p>
</div>
</div>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># specific return periods (e.g., 10, 20 years)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>rperiods <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">100</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># compute return levels (with 95% confidence intervals)</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>rlevels <span class="ot">=</span> <span class="fu">return.level</span>(nsgevfit, <span class="at">return.period=</span>rperiods)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For easy visualization, we will plot the <strong><code>effective return levels</code></strong> for each year over time period. Lets convert the output of <strong><code>return.level(...)</code></strong> into a clean data.frame :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data.frame</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>df_rlevels <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year=</span>extractedAMF<span class="sc">$</span>Year,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Q2=</span>rlevels[, <span class="dv">1</span>],</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Q5=</span>rlevels[, <span class="dv">2</span>],</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Q10=</span>rlevels[, <span class="dv">3</span>],</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Q20=</span>rlevels[, <span class="dv">4</span>],</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Q50=</span>rlevels[, <span class="dv">5</span>],</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Q100=</span>rlevels[, <span class="dv">6</span>])</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_rlevels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year       Q2       Q5      Q10      Q20      Q50     Q100
1 1958 24.36654 40.19203 54.81061 73.04541 104.8170 136.6172
2 1959 24.33894 40.16443 54.78301 73.01781 104.7894 136.5896
3 1960 24.31134 40.13683 54.75541 72.99021 104.7618 136.5620
4 1961 24.28374 40.10923 54.72781 72.96261 104.7342 136.5344
5 1962 24.25614 40.08163 54.70021 72.93501 104.7066 136.5068
6 1963 24.22854 40.05403 54.67261 72.90741 104.6790 136.4792</code></pre>
</div>
</div>
<p>Now, we tranform the data into a long (tidy) format suitable for plotting multiple lines with <strong><code>ggplot</code></strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dataplot <span class="ot">=</span> df_rlevels <span class="sc">|&gt;</span> <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="at">names_to=</span><span class="st">"RL"</span>, <span class="at">values_to=</span><span class="st">"Q"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we plot the <strong><code>effective return levels</code></strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>rlplot <span class="ot">=</span> dataplot <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>Q, <span class="at">color=</span>RL, <span class="at">group=</span>RL)) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_line</span>(<span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">scale_x_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>)) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">scale_y_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">150</span>), <span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">25</span>, <span class="dv">200</span>, <span class="at">by=</span><span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">guides</span>(<span class="at">color=</span><span class="fu">guide_legend</span>(<span class="at">keywidth=</span><span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color=</span><span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>         <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Time (Year)"</span>, <span class="at">y=</span><span class="st">"Return level (Q)"</span>, <span class="at">color=</span><span class="cn">NULL</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rlplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#fig-effective-return-levels" class="quarto-xref">Figure&nbsp;8</a> helps in understanding the variations and trends in flood quantiles across different time periods.‚Äù</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-effective-return-levels" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-effective-return-levels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-effective-return-levels-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-effective-return-levels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Effective return levels from the NS-GEV model. Each line represents a different return period (e.i., 2-, 5-, 10-, 20 50, and 100-year floods), and the colour coding indicates these return periods. The x-axis denotes the time index (year), and the y-axis indicates the estimated flood quantiles.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="uncertainty-estimation" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Uncertainty estimation</h1>
<p>Computing uncertainties in FFA is essential as it helps quantify the <strong>confidence</strong> and <strong>reliability</strong> of estimated flood magnitudes and return levels.</p>
<p>üîç <strong>Acknowledge Data Limitations</strong></p>
<p>Hydrological records are often short or incomplete. Uncertainty analysis helps reflect the limited information available and avoids overconfidence in estimates.</p>
<p>üìä <strong>Support Risk-Based Decision Making</strong></p>
<p>Infrastructure design, floodplain mapping, and insurance policies rely on return levels. Knowing the uncertainty helps stakeholders assess risk margins and make safer choices.</p>
<p>üìà <strong>Evaluate Model Robustness</strong></p>
<p>Comparing uncertainty across models (e.g., GEV vs Gumbel) can guide model selection and reveal sensitivity to assumptions or input data.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
üåä Want to Go Further? Quantify Your Confidence!
</div>
</div>
<div class="callout-body-container callout-body">
<p>The simpler way to estimate the uncertainty is to compute a <strong>normalized uncertainty range</strong>, as defined below:</p>
<p><span class="math display">
\text{Unc [-]} = \frac{Q_{97.5} - Q_{2.5}}{Q_{est}}
\tag{13}
</span> where <span class="math inline">Q_{97.5}</span> is the upper (97.5%) bound of the confidence interval, <span class="math inline">Q_{2.5}</span> is the lower (2.5%) bound of the confidence interval, <span class="math inline">Q_{est}</span> is the estimated quantile.</p>
</div>
</div>
</section>
<section id="references" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-gumbel1958statistics" class="csl-entry" role="listitem">
Gumbel, E. J. (1958). <em>Statistics of extremes</em>. Columbia University Press. <a href="https://doi.org/10.7312/gumb92958">https://doi.org/10.7312/gumb92958</a>
</div>
<div id="ref-kendall_rank_1975" class="csl-entry" role="listitem">
Kendall, M. G. (1975). <em>Rank correlation methods</em> (4th ed., 2d impression). Griffin London.
</div>
<div id="ref-mann1945nonparametric" class="csl-entry" role="listitem">
Mann, H. B. (1945). Nonparametric tests against trend. <em>Econometrica: Journal of the Econometric Society</em>, 245‚Äì259.
</div>
<div id="ref-Sen1968" class="csl-entry" role="listitem">
Sen, P. K. (1968). Estimates of the regression coefficient based on kendall‚Äôs tau. <em>Journal of the American Statistical Association</em>, <em>63</em>(324), 1379‚Äì1389. <a href="https://doi.org/10.1080/01621459.1968.10480934">https://doi.org/10.1080/01621459.1968.10480934</a>
</div>
<div id="ref-wald_test_1940" class="csl-entry" role="listitem">
Wald, A., &amp; Wolfowitz, J. (1940). On a test whether two samples are from the same population. <em>The Annals of Mathematical Statistics</em>, <em>11</em>(2), 147‚Äì162. <a href="https://doi.org/10.1214/aoms/1177731909">https://doi.org/10.1214/aoms/1177731909</a>
</div>
</div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/diopbachir\.github\.io\/tp_eva\/index\.html");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>¬© Copyright 2025</p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="http://orcid.org/0000-0003-0481-5330">
<p>Yves Tramblay <i class="fa-brands fa-orcid"></i></p>
</a>
  </li>  
    <li class="nav-item">
 |
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://orcid.org/0009-0002-8743-3660">
<p>Serigne Bassirou Diop <i class="fa-brands fa-orcid"></i></p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
<p>Powered by <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>